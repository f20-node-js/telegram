let testData = [
  {
    id: 0,
    firstName: 'Admin',
    lastName: 'Fulfiledu',
    bio: `Fulfil education va Instant group bo'yicha savollaringizni bering!`,
    category: 'person',
    online: true,
    enableNotf: true,
    avatar: 'https://static10.tgstat.ru/channels/_0/4b/4bee0aec8083826b79c227eac9d2cf27.jpg',
    photos: [
      'https://picsum.photos/id/1/200',
      'https://picsum.photos/id/2/200',
      'https://picsum.photos/id/3/200'
    ],
    userName: '@fulfiledu',
    phone: '+1234567',

    files: {
      media: 'Fulfiledu media',
      docs: 'Fulfiledu docs',
      links: 'Fulfiledu links',
      audio: 'Fulfiledu audio'
    },

    messages: [
      {
        id: 0,
        isMy: false,
        text: `Frontend dasturlash kursi yangi guruhi darslari start olmoqda, Kursda HTML, CSS, Sass, JavaScript, ReactJS o'rgatiladi, Kurs 6 oy haftada 3 martadan Zoomda davom etadi`,
        time: '10 : 00',
      },
      {
        id: 1,
        isMy: true,
        text: `Kursga qatnashuvchida boshlang'ich bilimlar talab etilmaydi, barchasi noldan boshlanadi`,
        time: '10 : 10'
      }
    ]

  },
  {
    id: 1,
    firstName: 'Toshmat',
    lastName: 'Eshmatov',
    bio: `making it look like readable English`,
    online: false,
    enableNotf: false,
    category: 'person',
    avatar: 'https://picsum.photos/id/4/200',
    photos: [
      'https://picsum.photos/id/5/200',
      'https://picsum.photos/id/6/200',
      'https://picsum.photos/id/7/200'
    ],
    userName: '@Toshmat',
    phone: '+7654321',

    files: {
      media: 'Toshmat2 media',
      docs: 'Toshmat2 docs',
      links: 'Toshmat2 links',
      audio: 'Toshmat2 audio'
    },

    messages: [
      {
        id: 0,
        time: '11 : 00',
        isMy: false,
        text: 'Lorem Ipsum is simply dummy text of the printing'
      },
      {
        id: 1,
        time: '11 : 10',
        isMy: true,
        text: 'It is a long established fact that a reader will be distracted by the readable content of a page when'
      }
    ]

  },
  {
    id: 2,
    firstName: 'F-20',
    lastName: 'Backend',
    bio: `5 oy davomida birgalikda JavaScriptga asoslangan Backendni tajribali middle dasturchi Asadbek Zoirovdan o'rganasiz..`,
    online: false,
    enableNotf: true,
    category: 'group',
    avatar: 'https://w-dog.ru/wallpapers/0/5/426067694033869/samolet-aviaciya-istrebitel-f-16-f-16-rakety.jpg',
    photos: [
      'https://picsum.photos/id/9/200',
      'https://picsum.photos/id/10/200',
      'https://picsum.photos/id/11/200'
    ],
    userName: '@Backend',
    phone: '+77777777777',

    files: {
      media: 'Backend F-20 media',
      docs: 'Backend F-20 docs',
      links: 'Backend F-20 links',
      audio: 'Backend F-20 audio'
    },

    messages: [
      {
        id: 0,
        time: '12 : 00',
        isMy: true,
        text: 'Contrary to popular belief, Lorem Ipsum is not simply random text'
      }
    ]

  },
  {
    id: 3,
    firstName: 'dasturlash',
    lastName: 'Backend',
    bio: 'Backend-dasturlash',
    online: false,
    enableNotf: false,
    category: 'group',
    avatar: 'https://library.kissclipart.com/20181006/oje/kissclipart-software-icon-png-clipart-computer-software-softwa-fb8ba66b8f9f7232.jpg',
    photos: [
      'https://picsum.photos/id/13/200',
      'https://picsum.photos/id/14/200',
      'https://picsum.photos/id/15/200'
    ],
    userName: '@Backend-dasturlash',
    phone: '+548521848',


    files: {
      media: 'Backend-dasturlash media',
      docs: 'Backend-dasturlash docs',
      links: 'Backend-dasturlash links',
      audio: 'Backend-dasturlash audio'
    },

    messages: [
      {
        id: 0,
        isMy: false,
        text: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an`,
        time: '13 : 00',
      },

    ]

  },
  {
    id: 4,
    firstName: `Channel`,
    lastName: `Durov's`,
    bio: 'Thoughts from the Product Manager / CEO / Founder of Telegram.',
    online: false,
    enableNotf: true,
    category: 'channel',
    avatar: 'https://cdn.tlgrm.app/channels/10/06/1006503122/avatar640.jpg',
    photos: [
      'https://picsum.photos/id/17/200',
      'https://picsum.photos/id/18/200',
      'https://picsum.photos/id/19/200'
    ],
    userName: '@durov',
    phone: '+2184218552',


    files: {
      media: `Durov's Channel media`,
      docs: `Durov's Channel docs`,
      links: `Durov's Channel links`,
      audio: `Durov's Channel audio`
    },

    messages: [
      {
        id: 0,
        isMy: false,
        text: `In 2022, Telegram is again among the top 5 most downloaded apps in the world (just like in 2021). Of these top 5 most popular apps, Telegram is the only one that doesn't spend`,
        time: '14 : 00',
      },

    ]

  },
  {
    id: 5,
    firstName: `eJarima.uz`,
    lastName: ``,
    bio: 'x',
    online: false,
    enableNotf: true,
    category: 'bot',
    avatar: 'https://yt3.ggpht.com/ytc/AKedOLTqW6dcY9KSdV9C0wkMs9P6httNHdwb9gSePcPg=s900-c-k-c0x00ffffff-no-rj',
    photos: [
      'https://picsum.photos/id/17/200',
      'https://picsum.photos/id/18/200',
      'https://picsum.photos/id/19/200'
    ],
    userName: '@JARIMAUZ_BOT',
    phone: '+2364563456',


    files: {
      media: `eJarima.uz  media`,
      docs: `eJarima.uz  docs`,
      links: `eJarima.uz  links`,
      audio: `eJarima.uz  audio`
    },

    messages: [
      {
        id: 0,
        isMy: false,
        text: `Tizimda texnik ishlar olib borilayotganligi munosabati bilan bot vaqtincha ishlamaydi. Noqulayliklar uchun uzr soâ€˜raymiz!`,
        time: '15 : 00',
      },

    ]

  },

];




const body = document.getElementById('body');
const chat_list = document.getElementById('chat_list');
const notficationCheckbox = document.getElementById('notficationCheckbox');
const centerNotificationBell = document.getElementById('centerNotificationBell');
const rightNotifcation = document.getElementById('rightNotifcation');
const rightMedia = document.getElementById('rightMedia').children;
const folder = document.getElementsByClassName('folder');
const folderP = document.getElementsByClassName('folderP');



let currentUser = 0;
let currentFilePanel = 'Media';
let currentFolder = 'All';
let currentLi = 0;
let currentUserId = 0;

let data = JSON.parse(localStorage.getItem("data"));

if (data == null) {
  localStorage.setItem('data', JSON.stringify(testData));
  data = JSON.parse(localStorage.getItem("data"));
}


function updateLocalStorage(array) {
  localStorage.setItem('data', JSON.stringify(array));
};


function findBiggestID(data) {
  let bigId = 0;
  data.forEach(element => {
    if (element.id > bigId) bigId = element.id;
  });
  return bigId;
};

// Change folder -----------------------------------------------------------------------------------
function changeFolder(i, array) {
  for (let k = 0; k < folderP.length; k++) {
    folder[k].className = 'folder flex items-center justify-center block py-2 text-xs font-semibold leading-normal tracking-wide border-b-2 border-transparent';
  };
  folder[i].className = 'folder flex items-center justify-center block py-2 text-xs font-semibold leading-normal tracking-wide border-b-2 border-blue-500';

  switch (i) {
    case 0: currentFolder = 'All';
      break;
    case 1: currentFolder = 'Person';
      break;
    case 2: currentFolder = 'Groups';
      break;
    case 3: currentFolder = 'Channels';
      break;
    case 4: currentFolder = 'Bots';
      break;
  };

  renderChats(array, currentFolder)

}
changeFolder(0, data);
//--------------------------------------------------------------------------------------------------


function changeMediaPanel(currentUser, currentFilePanel) {
  switch (currentFilePanel) {
    case 'Media':
      filesDiv.innerHTML = `${data[currentUser].files.media}`;
      break;
    case 'Docs':
      filesDiv.innerHTML = `${data[currentUser].files.docs}`;
      break;
    case 'Links':
      filesDiv.innerHTML = `${data[currentUser].files.links}`;
      break;
    case 'Audio':
      filesDiv.innerHTML = `${data[currentUser].files.audio}`;
      break;
  };
};


// Change User function --------------------------------------------------------
function ChangeUser(userID, i) {
  const rightUserName = document.getElementById('rightUserName');
  const rightBio = document.getElementById('rightBio');
  const rightImg = document.getElementById('rightImg');
  const rightUname = document.getElementById('rightUname');
  const rightPhone = document.getElementById('rightPhone');
  const centerUserName = document.getElementById('centerUserName');
  const centerAvater = document.getElementById('centerAvater');
  const centerOnline = document.getElementById('centerOnline');
  const rightOnline = document.getElementById('rightOnline');


  currentLi = i;
  currentUserId = userID;
  //currentUser = data[userID].id - 0;

  if ((userID == 0) && (i == 0)) {
    currentUser = 0;
    i = 0;
  }

  data.forEach(element => {
    if (element.id == userID) {
      currentUser = data.indexOf(element);
    }
  });


  rightImg.src = data[currentUser].avatar;
  rightUserName.innerHTML = `${data[currentUser].lastName} ${data[currentUser].firstName}`;
  rightBio.innerHTML = data[currentUser].bio;
  rightUname.innerHTML = data[currentUser].userName;
  rightPhone.innerHTML = data[currentUser].phone;
  centerUserName.innerHTML = `${data[currentUser].lastName} ${data[currentUser].firstName}`;
  centerAvater.setAttribute(`style`, `background-image: url('${data[currentUser].avatar}')`);


  currentFilePanel = 'Media';
  filesDiv.innerHTML = `${data[currentUser].files.media}`;

  // clear file panel
  for (let k = 0; k < rightMedia.length; k++) {
    rightMedia[k].firstElementChild.className = 'block py-3 text-xs font-bold leading-normal uppercase border-b-4 border-transparent';
  };
  // set file panel
  rightMedia[0].firstElementChild.className = 'block py-3 text-xs font-bold leading-normal uppercase border-b-4 border-blue-500 text-blue-500';

  if (data[currentUser].online) {
    centerOnline.innerHTML = 'Online';
    rightOnline.className = 'text-sm font-medium text-center text-blue-500';
    rightOnline.innerHTML = 'online';
  } else {
    centerOnline.innerHTML = 'Offline';
    rightOnline.className = 'text-sm font-medium text-center text-gray-600';
    rightOnline.innerHTML = 'offline';
  }

  if (data[currentUser].enableNotf) {
    centerNotificationBell.src = './img/noton.svg';
    rightNotifcation.innerHTML = 'Enabled';
    notficationCheckbox.checked = true;
  } else {
    centerNotificationBell.src = './img/notoff.svg';
    rightNotifcation.innerHTML = 'Disabled';
    notficationCheckbox.checked = false;
  }

  const nameH2 = document.getElementsByClassName('nameH2');
  const liTime = document.getElementsByClassName('time');
  const newLi = document.getElementsByClassName('newLi');
  for (let k = 0; k < newLi.length; k++) {
    newLi[k].classList.remove('active');
    nameH2[k].classList.remove('active');
    liTime[k].classList.remove('active');
  };
  if (newLi.length != 0) {
    newLi[i].classList.add('active')
    nameH2[i].classList.add('active')
    liTime[i].classList.add('active')
  }
  //Change Messages ------------------------------------------------------------------------------
  const messageDiv = document.getElementById('messageDiv');

  while (messageDiv.firstChild) {
    messageDiv.removeChild(messageDiv.firstChild);
  };

  let message = data[currentUser].messages;

  for (let k = 0; k < message.length; k++) {
    let text = document.createElement('div');

    message[k].isMy ? text.className = 'self-end w-3/4 my-2' : text.className = 'self-start w-3/4 my-2';

    text.innerHTML =
      `
        <div class="p-4 text-sm bg-white rounded-t-lg rounded-l-lg shadow">
          ${message[k].text}
          <div class="mTime">${message[k].time}</div>
        </div>
        
      `;

    messageDiv.appendChild(text);;
  };
  // ------------------------------------------------------------------------------------------------


};
//-------------------------------------------------------------------------------


// Render chats --------------------------------------------------------------------------------------
function renderChats(data, currentFolder) {
  let chats = [];

  while (chat_list.firstChild) {
    chat_list.removeChild(chat_list.firstChild);
  };

  switch (currentFolder) {
    case 'All':
      chats = data
      break;
    case 'Person':
      data.forEach(element => {
        if (element.category == 'person') chats.push(element);
      });
      break;
    case 'Groups':
      data.forEach(element => {
        if (element.category == 'group') chats.push(element);
      });
      break;
    case 'Channels':
      data.forEach(element => {
        if (element.category == 'channel') chats.push(element);
      });
      break;
    case 'Bots':
      data.forEach(element => {
        if (element.category == 'bot') chats.push(element);
      });
      break;
  };





  // Create new chats-------------------------------------------------------------------
  chats.forEach(chat => {

    let newChat = document.createElement('li');
    newChat.className = 'flex flex-no-wrap items-center pr-3 text-black rounded-lg cursor-pointer mt-200 py-65 hover:bg-gray-200 newLi';
    newChat.setAttribute('style', 'padding-top: 0.65rem; padding-bottom: 0.65rem');

    let time = null;
    let text = null;

    if (chat.messages.length > 0) {
      time = chat.messages[chat.messages.length - 1].time;
      text = chat.messages[chat.messages.length - 1].text.slice(0, 27);
    } else {
      time = '';
      text = '';
    };



    if (chat.online) {
      newChat.innerHTML = `
        <div id="userIdDiv" style="display: none">${chat.id}</div>
        <div class="flex justify-between w-full focus:outline-none">
        <div class="flex justify-between w-full">
          <div class="relative flex items-center justify-center w-12 h-12 ml-2 mr-3 text-xl font-semibold text-white bg-blue-500 rounded-full flex-no-shrink">
            <img class="object-cover w-12 h-12 rounded-full" src="${chat.avatar}" alt="">
            <div class="absolute bottom-0 right-0 flex items-center justify-center bg-white rounded-full" style="width: 0.80rem; height: 0.80rem">
              <div class="bg-green-500 rounded-full" style="width: 0.6rem; height: 0.6rem"></div>
            </div>
          </div>
          <div class="items-center flex-1 min-w-0">
            <div class="flex justify-between mb-1">
              <h2 class="text-sm font-semibold text-black nameH2">${chat.lastName} ${chat.firstName}</h2>
              <div class="flex">
                <span class="ml-1 text-xs font-medium text-gray-600 time">${time}</span>
              </div>
            </div>
            <div class="flex justify-between text-sm leading-none truncate">
              <span>${text}...</span>
            </div>
          </div>
        </div>
      </div>

        `
    } else {

      newChat.innerHTML = `
        <div id="userIdDiv" style="display: none">${chat.id}</div>
        <div class="flex justify-between w-full focus:outline-none">
        <div class="flex justify-between w-full">
          <div class="relative flex items-center justify-center w-12 h-12 ml-2 mr-3 text-xl font-semibold text-white bg-blue-500 rounded-full flex-no-shrink">
            <img class="object-cover w-12 h-12 rounded-full" src="${chat.avatar}" alt="">
          </div>
          <div class="items-center flex-1 min-w-0">
            <div class="flex justify-between mb-1">
              <h2 class="text-sm font-semibold text-black names nameH2">${chat.lastName} ${chat.firstName}</h2>
              <div class="flex">
                <span class="ml-1 text-xs font-medium text-gray-600 time">${time}</span>
              </div>
            </div>
            <div class="flex justify-between text-sm leading-none truncate">
              <span>${text}...</span>
            </div>
          </div>
        </div>
      </div>

        `
    }
    chat_list.appendChild(newChat);
  });
  //-------------------------------------------------------------------------------------






  //Toogle notification-------------------------------------------------------------------------------------
  function toggleNotification() {

    let status = data[currentUser].enableNotf;

    if (status == false) {
      centerNotificationBell.src = './img/noton.svg';
      rightNotifcation.innerHTML = 'Enabled';
      notficationCheckbox.checked = true;

      data[currentUser].enableNotf = true;
      updateLocalStorage(data);
    } else if (status == true) {
      centerNotificationBell.src = './img/notoff.svg';
      rightNotifcation.innerHTML = 'Disabled';
      notficationCheckbox.checked = false;

      data[currentUser].enableNotf = false;
      updateLocalStorage(data);
    }

  };

  centerNotificationBell.parentNode.onclick = (e) => { toggleNotification() };

  notficationCheckbox.onclick = (e) => { toggleNotification() };
  //-------------------------------------------------------------------------------------------------





  // Change right Media panel----------------------------------------------------------------
  for (let i = 0; i < rightMedia.length; i++) {
    rightMedia[i].onclick = (e) => {
      let tag = null;

      const filesDiv = document.getElementById('filesDiv');

      e.target.tagName == 'LI' ? tag = e.target.children[0] : tag = e.target;

      currentFilePanel = tag.innerHTML.trim();

      for (let k = 0; k < rightMedia.length; k++) {
        rightMedia[k].firstElementChild.className = 'block py-3 text-xs font-bold leading-normal uppercase border-b-4 border-transparent';
      };

      tag.className = 'block py-3 text-xs font-bold leading-normal uppercase border-b-4 border-blue-500 text-blue-500';

      changeMediaPanel(currentUser, currentFilePanel);
    };

  };
  //---------------------------------------------------------------------------------------




  //Add Event Listener---------------------------------------------------------------------------
  let newLi = document.getElementsByClassName('newLi');
  if (newLi.length != 0) {
    ChangeUser(parseInt(newLi[0].firstChild.nextSibling.innerHTML), 0);

    for (let i = 0; i < newLi.length; i++) {
      newLi[i].addEventListener('click', (e) => {
        let a = newLi[i].firstChild.nextSibling.innerHTML;
        a = parseInt(a);
        ChangeUser(a, i);
      });
    };
  };

  //---------------------------------------------------------------------------------------------

};

for (let i = 0; i < folderP.length; i++) {
  folderP[i].addEventListener('click', (e) => {

    changeFolder(i, data);


  });
};
//--------------------------------------------------------------------------------------------------






// Edit contact -------------------------------------------------------------------------------------------------
const editContact = document.getElementById('editContact');

function editUser(currentUser) {

  if (data[currentUser].category == 'person') {
    let editDiv = document.createElement('div');
    editDiv.className = 'changeContact';
    editDiv.innerHTML =
      `
    <div class="changeContactDiv">
      <div class="chCtext">Change Contact</div>
        <div class="chClogo">
          <div class="logo">
            <img src="${data[currentUser].avatar}" alt="">
          </div>
          <div class="number">${data[currentUser].phone}</div>
          </div>
          <div class="chCfirstName"><input type="text" id="chCfName" placeholder="First name" value="${data[currentUser].firstName}"></div>
          <div class="chClastName"><input type="text" id="chClName" placeholder="Last name" value="${data[currentUser].lastName}"></div>
          <div class="chCbuttons">
            <button id="chCno">Cancel</button>
            <button id="chCyes">Ok</button>
          </div>
    </div>

    `;
    body.append(editDiv);

    editDiv.addEventListener('click', (e) => {
      if (e.target.className == 'changeContact') {
        body.removeChild(editDiv);
      }
    });

    const chCno = document.getElementById('chCno');
    chCno.addEventListener('click', (e) => {
      body.removeChild(editDiv);
    });

    const chCyes = document.getElementById('chCyes');

    chCyes.addEventListener('click', (e) => {
      let firstName = document.getElementById('chCfName').value;
      let lastName = document.getElementById('chClName').value;

      data[currentUser].firstName = firstName;
      data[currentUser].lastName = lastName;
      updateLocalStorage(data);

      renderChats(data, currentFolder);

      body.removeChild(editDiv);
    });

  } else {
    alert('You can change only your contact(person)');
  }
};


editContact.addEventListener('click', (e) => {

  editUser(currentUser);
});

// -------------------------------------------------------------------------------------------------------------




// Delete Contact -------------------------------------------------------------------
const contactSettings = document.getElementById('contactSettings');

function changeContactSetting(currentUser) {
  let contactSettings = document.createElement('div');
  contactSettings.className = 'contactSettings';
  contactSettings.innerHTML =
    `
    <div class="contactSettingsDiv">
      <img src="./img/delete.svg" alt="">
      <span>Delete user</span>
    </div>

    `;
  body.append(contactSettings);

  contactSettings.addEventListener('click', (e) => {
    if (e.target.className == 'contactSettings') {
      body.removeChild(contactSettings);
    }
  });

  const contactSettingsDiv = document.getElementsByClassName('contactSettingsDiv')[0];
  contactSettingsDiv.addEventListener('click', (e) => {

    if (confirm(`${data[currentUser].lastName} ${data[currentUser].firstName}  o'chirilsinmi`)) {
      data.splice(currentUser, 1);
      updateLocalStorage(data);
      renderChats(data, currentFolder);
      body.removeChild(contactSettings);
    }
    return;
  });



};

contactSettings.addEventListener('click', (e) => {

  changeContactSetting(currentUser);
});
// ----------------------------------------------------------------------------------




// Create left menu ---------------------------------------------------------------------------
const leftMenuButton = document.getElementById('leftMenuButton');

function createLeftMenu(currentUser) {

  // Render menu ---------------------------------
  let leftMenu = document.createElement('div');
  leftMenu.className = 'leftMenu';
  leftMenu.innerHTML =
    `
    <div class="leftMenuDiv">
      <div class="newGruopdiv"><img draggable="false" src="./img/group.svg" alt="">New gruop</div>
      <div class="newChannel"><img draggable="false" src="./img/channel.svg" alt="">New channel</div>
      <div class="newcontact"><img draggable="false" src="./img/contact.svg" alt="">New contact</div>
      <div class="calls"><img draggable="false" src="./img/call.svg" alt="">Calls</div>
      <div class="saved"><img draggable="false" src="./img/saved.svg" alt="">Saved</div>
      <div class="settings"><img draggable="false" src="./img/settings.svg" alt="">Settings</div>
      <div class="nightMode"><img draggable="false" src="./img/night.svg" alt="">Night mode</div>
    </div>

    `;
  body.append(leftMenu);

  leftMenu.addEventListener('click', (e) => {
    if (e.target.className == 'leftMenu') {
      body.removeChild(leftMenu);
    }
  });
  // -----------------------------------------------


  // Add new Group ---------------------------------
  const newGruopdiv = document.getElementsByClassName('newGruopdiv')[0];
  function addNewGroup() {
    body.removeChild(leftMenu);


    let newGroup = document.createElement('div');
    newGroup.className = 'newGroup';
    newGroup.innerHTML =
      `
      <div class="newGroupDiv">
      <div>
          Group name: <input type="text" id="gName">
      </div>
      <div>
          Group user name: <input type="text" id="gUserName">
      </div>
      <div>
          <button class="newGropNo">Cancel</button>
          <button class="newGropYes">Ok</button>
      </div>

    `;
    body.append(newGroup);

    newGroup.addEventListener('click', (e) => {
      if (e.target.className == 'newGroup') {
        body.removeChild(newGroup);
      }
    });

    const newGropNo = document.getElementsByClassName('newGropNo')[0];
    const newGropYes = document.getElementsByClassName('newGropYes')[0];

    newGropNo.addEventListener('click', (e) => {
      body.removeChild(newGroup);
    });


    newGropYes.addEventListener('click', (e) => {
      let groupName = document.getElementById('gName').value;
      let groupUserName = document.getElementById('gUserName').value;

      if ((groupName != '') && (groupUserName != '')) {

        let id = findBiggestID(data) + 1;
        let firstName = groupName;
        let lastName = '';
        let bio = '';
        let online = false;
        let enableNotf = true;
        let category = 'group';
        let avatar = `https://picsum.photos/id/${id}/200/300`;
        let photos = [];
        let userName = groupUserName;
        let phone = '';
        let files = {
          media: `${firstName}  media`,
          docs: `${firstName}  docs`,
          links: `${firstName}  links`,
          audio: `${firstName}  audio`
        };
        let messages = [];

        let newGroupObject = {
          id: id,
          firstName: firstName,
          lastName: lastName,
          bio: bio,
          online: online,
          enableNotf: enableNotf,
          category: category,
          avatar: avatar,
          photos: photos,
          userName: userName,
          phone: phone,
          files: files,
          messages: messages
        };

        data.push(newGroupObject);
        updateLocalStorage(data);
        changeFolder(0, data);
        changeFolder(0, data);

        body.removeChild(newGroup);
      } else {
        alert(`Ma'lumotlarni to'ldirish majburiy`);
      };


    });

  };

  newGruopdiv.addEventListener('click', (e) => {
    addNewGroup(currentUser)
  });
  //-------------------------------------------------



  // Add new channel ---------------------------------
  const newChannel = document.getElementsByClassName('newChannel')[0];
  function addChannel() {
    body.removeChild(leftMenu);


    let newChannell = document.createElement('div');
    newChannell.className = 'newGroup';
    newChannell.innerHTML =
      `
        <div class="newGroupDiv">
        <div>
            Channel name: <input type="text" id="gName">
        </div>
        <div>
            Channel user name: <input type="text" id="gUserName">
        </div>
        <div>
            <button class="newChannelNo">Cancel</button>
            <button class="newChannelYes">Ok</button>
        </div>
  
      `;
    body.append(newChannell);

    newChannell.addEventListener('click', (e) => {
      if (e.target.className == 'newGroup') {
        body.removeChild(newChannell);
      }
    });

    const newChannelNo = document.getElementsByClassName('newChannelNo')[0];
    const newChannelYes = document.getElementsByClassName('newChannelYes')[0];

    newChannelNo.addEventListener('click', (e) => {
      body.removeChild(newChannel);
    });


    newChannelYes.addEventListener('click', (e) => {
      let channelName = document.getElementById('gName').value;
      let channelUserName = document.getElementById('gUserName').value;

      if ((channelName != '') && (channelUserName != '')) {

        let id = findBiggestID(data) + 1;
        let firstName = channelName;
        let lastName = '';
        let bio = '';
        let online = false;
        let enableNotf = true;
        let category = 'channel';
        let avatar = `https://picsum.photos/id/${id}/200/300`;
        let photos = [];
        let userName = channelUserName;
        let phone = '';
        let files = {
          media: `${firstName}  media`,
          docs: `${firstName}  docs`,
          links: `${firstName}  links`,
          audio: `${firstName}  audio`
        };
        let messages = [];

        let newcChannel = {
          id: id,
          firstName: firstName,
          lastName: lastName,
          bio: bio,
          online: online,
          enableNotf: enableNotf,
          category: category,
          avatar: avatar,
          photos: photos,
          userName: userName,
          phone: phone,
          files: files,
          messages: messages
        };

        data.push(newcChannel);
        updateLocalStorage(data);
        changeFolder(0, data);
        changeFolder(0, data);
        body.removeChild(newChannell);
      } else {
        alert(`Ma'lumotlarni to'ldirish majburiy`);
      };


    });


  };

  newChannel.addEventListener('click', (e) => {
    addChannel(currentUser);
  });
  //-------------------------------------------------


  // Add new contact ---------------------------------
  const contact = document.getElementsByClassName('newcontact')[0];
  function addContact() {
    body.removeChild(leftMenu);


    let newContact = document.createElement('div');
    newContact.className = 'newGroup';
    newContact.innerHTML =
      `
          <div class="newGroupDiv">
          <div>
              First name: <input type="text" id="fName">
          </div>
          <div>
              Last name: <input type="text" id="Lname">
          </div>
          <div>
              Phone: <input type="text" id="Phone">
          </div>
          <div>
              <button class="newContactNo">Cancel</button>
              <button class="newContactYes">Ok</button>
          </div>
    
        `;
    body.append(newContact);

    newContact.addEventListener('click', (e) => {
      if (e.target.className == 'newGroup') {
        body.removeChild(newContact);
      }
    });

    const newContactNo = document.getElementsByClassName('newContactNo')[0];
    const newContactYes = document.getElementsByClassName('newContactYes')[0];

    newContactNo.addEventListener('click', (e) => {
      body.removeChild(newContact);
    });


    newContactYes.addEventListener('click', (e) => {
      let CfirstName = document.getElementById('fName').value;
      let ClastName = document.getElementById('Lname').value;
      let Cphone = document.getElementById('Phone').value;

      if ((CfirstName != '') && (ClastName != '') && (Cphone != '')) {

        let id = findBiggestID(data) + 1;
        let firstName = CfirstName;
        let lastName = ClastName;
        let bio = '';
        let online = false;
        let enableNotf = true;
        let category = 'person';
        let avatar = `https://picsum.photos/id/${id}/200/300`;
        let photos = [];
        let userName = '';
        let phone = Cphone;
        let files = {
          media: `${firstName}  media`,
          docs: `${firstName}  docs`,
          links: `${firstName}  links`,
          audio: `${firstName}  audio`
        };
        let messages = [];

        let newcContactd = {
          id: id,
          firstName: firstName,
          lastName: lastName,
          bio: bio,
          online: online,
          enableNotf: enableNotf,
          category: category,
          avatar: avatar,
          photos: photos,
          userName: userName,
          phone: phone,
          files: files,
          messages: messages
        };

        data.push(newcContactd);
        updateLocalStorage(data);
        changeFolder(0, data);
        changeFolder(0, data);
        body.removeChild(newContact);
      } else {
        alert(`Ma'lumotlarni to'ldirish majburiy`);
      };


    });


  };

  contact.addEventListener('click', (e) => {
    addContact(currentUser);
  });
  //-------------------------------------------------


};

leftMenuButton.addEventListener('click', (e) => {
  createLeftMenu(currentUser);
})
//----------------------------------------------------------------------------------------------



// Send message ----------------------------------------------------------------------------------
const centerMessageInput = document.getElementById('centerMessageInput');

function sendMessage(data, input) {
  if (input.value != '') {
    let messageId = findBiggestID(data[currentUser].messages) + 1;
    let isMy = true;
    let text = input.value;

    let hours = new Date().getHours();
    let miutes = new Date().getMinutes();
    let time = hours + ' : ' + miutes;

    let message = {
      id: messageId,
      isMy: isMy,
      text: text,
      time: time
    };
    data[currentUser].messages.push(message);
    updateLocalStorage(data);
    ChangeUser(currentUserId, currentLi);
    input.value = '';
  }

};
centerMessageInput.addEventListener('keypress', (event) => {
  if (event.key == "Enter") {
    sendMessage(data, centerMessageInput);
  };
});

const leftPen = document.getElementById('leftPen');
leftPen.onclick = (e) => { centerMessageInput.focus() };

const sendMessageButton = document.getElementById('sendMessageButton');

sendMessageButton.addEventListener('click', (event) => {
  sendMessage(data, centerMessageInput);
});

//------------------------------------------------------------------------------------------------



// Search -----------------------------------------------------------------------------------------
const centerFindButton = document.getElementById('centerFindButton');
const leftSearchInput = document.getElementById('leftSearchInput');

centerFindButton.onclick = (e) => { leftSearchInput.focus() };


function searchUser(keyWord) {

  let newArray = data.filter((el) => {

    let fullName = el.firstName + el.lastName;
    return fullName.toLowerCase().includes(keyWord.toLowerCase());

  });
  changeFolder(0, newArray)
};

leftSearchInput.addEventListener('keyup', (e) => {

  if (e.target.value == '') {
    renderChats(data, currentFolder);
  } else {
    keyWord = leftSearchInput.value;
    searchUser(keyWord);
  }


});


//--------------------------------------------------------------------------------------------------


